[GOOGLE_SHEETS]
data_sheet_url = https://docs.google.com/spreadsheets/d/1Xl2g9PB9maA5WRuge284Wmqq1RZDFCWh4UrhpHf8sJI

[ERP_DATABASE]
# MS-SQL Server 資料庫連接設定
server = 192.168.98.10
database = AS_online
username = sa
password = dsc@23225889

[ERP_QUERIES]
# 自訂 SQL 查詢（可選）
# 如果提供，系統會使用這些查詢而不是預設查詢
# 查詢結果必須包含對應的欄位

# 餅乾庫存查詢（合併 INVLC 期初庫存、INVLA 進出數量和 INVMB 品號資料）
# INVLC: 期初庫存資料表
#   LC001: 品號, LC002: 年月, LC003: 庫別代號, LC004: 期初庫存數量
# INVLA: 每日進出數量資料表
#   LA001: 品號, LA004: 日期, LA005: 進出類型(-1=出庫, 1=入庫), LA009: 庫別代號, LA011: 數量
# INVMB: 品號資料表
#   MB001: 品號, MB002: 品名, MB004: 庫存單位
# 計算邏輯: 期初庫存 + SUM(進出數量 * 進出類型)
# 單位來源: 從 INVMB.MB004 取得，如果沒有則預設為 '片'
# 只查詢庫別代號 SP40, SP50, SP60, SP80
cookie_inventory_query = 
    SELECT 
        LC.LC001 as cookie_code,
        LC.LC003 as warehouse_code,
        LC.LC004 + COALESCE(SUM(LA.LA011 * LA.LA005), 0) as qty,
        COALESCE(MB.MB004, '片') as unit,
        COALESCE(MB.MB002, '') as cookie_name
    FROM [AS_online].[dbo].[INVLC] LC
    LEFT JOIN [AS_online].[dbo].[INVLA] LA 
        ON LA.LA001 = LC.LC001 
        AND LA.LA009 = LC.LC003
        AND LA.LA004 >= '20251201'
    LEFT JOIN [AS_online].[dbo].[INVMB] MB
        ON MB.MB001 = LC.LC001
    WHERE LC.LC001 IS NOT NULL 
        AND LC.LC002 = '202512' 
        AND LC.LC003 IN ('SP40', 'SP50', 'SP60', 'SP80')
    GROUP BY LC.LC001, LC.LC003, LC.LC004, MB.MB004, MB.MB002

# 在製品庫存查詢（從製令單頭 MOCTA 查詢，合併 INVMB 品號資料）
# MOCTA: 製令單頭資料表
#   TA001: 製令單別
#   TA002: 製令單號
#   TA006: 品號（餅乾代號）
#   TA003: 開單日期
#   TA011: 狀態碼（'3'=生產中）
#   TA016: 已領數量
#   TA017: 已生產數量
#   TA018: 報廢數量
# INVMB: 品號資料表
#   MB001: 品號, MB004: 庫存單位
# 計算邏輯: TA016 - TA017 - TA018（每筆製令分開呈現，不做加總）
# 單位來源: 從 INVMB.MB004 取得，如果沒有則預設為 '片'
# 條件: TA003 >= '20251101' AND TA011 = '3'
wip_inventory_query = 
    SELECT 
        MO.TA001 as mo_number_type,
        MO.TA002 as mo_number,
        MO.TA006 as cookie_code,
        (MO.TA016 - MO.TA017 - ISNULL(MO.TA018, 0)) as wip_qty,
        COALESCE(MB.MB004, '片') as unit,
        COALESCE(MB.MB002, '') as cookie_name
    FROM [AS_online].[dbo].[MOCTA] MO
    LEFT JOIN [AS_online].[dbo].[INVMB] MB
        ON MB.MB001 = MO.TA006
    WHERE MO.TA003 >= '20251101'
        AND MO.TA011 = '3'
        AND MO.TA006 IS NOT NULL
        AND (MO.TA016 - MO.TA017 - ISNULL(MO.TA018, 0)) > 0
    ORDER BY MO.TA006, MO.TA001, MO.TA002

# 禮盒成品庫存查詢範例（請根據實際資料表結構調整）
# box_inventory_query = 
#     SELECT 
#         box_code as box_code,
#         current_stock as qty,
#         '盒' as unit
#     FROM finished_goods_table
#     WHERE item_type = 'BOX'