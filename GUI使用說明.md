# 餅乾庫存算料系統 - GUI 使用說明

## 啟動程式

### 方式一：直接執行 Python 腳本
```bash
python cookie_inventory_gui.py
```

### 方式二：執行打包後的 exe 檔案
雙擊 `餅乾庫存算料系統.exe`

## 功能說明

### 主視窗介面

程式啟動後會顯示以下介面：

1. **功能選單區**（左側）
   - 包含所有可執行的功能按鈕

2. **執行日誌區**（右側）
   - 顯示程式執行過程的詳細日誌
   - 可以滾動查看歷史記錄

3. **狀態列**（底部）
   - 顯示當前執行狀態

### 功能按鈕說明

#### 1. 同步 Index 資料
- **功能**：從 ERP 系統同步品名、生重、熟重資料到 Google Sheets Index 工作表
- **執行內容**：
  - 讀取 Index 工作表的所有代號
  - 從 ERP 資料庫 INVMB 表查詢品名（MB002）、生重（MB104）、熟重（MB105）
  - 更新 Index 工作表的對應欄位
  - 如果 Index 工作表沒有「生重」和「熟重」欄位，會自動新增
- **使用時機**：需要更新 Index 工作表的品名、生重、熟重資料時

#### 2. 同步在製品庫存
- **功能**：從 ERP 系統同步在製品庫存資料到 Google Sheets
- **執行內容**：
  - 查詢生產中的製令單
  - 計算在製品數量（已領數量 - 已生產數量）
  - 更新 Google Sheets 的「在製品庫存」工作表
- **使用時機**：需要更新在製品庫存時

#### 3. 同步生產排程
- **功能**：重新計算並更新生產排程的生產片數
- **執行內容**：
  - 讀取生產排程工作表
  - 從 Index 工作表讀取生重資料
  - 計算生產片數 = 生產顆數 × 160000 ÷ 生重 × 0.95
  - 更新生產排程工作表
- **使用時機**：生產排程有變更，需要重新計算生產片數時

#### 4. 計算庫存預估
- **功能**：計算未來 21 天的庫存預估
- **執行內容**：
  - 讀取期初庫存、BOM 表、生產排程、組裝排程
  - 逐日計算每種餅乾的庫存變化
  - 檢測負庫存情況
  - 輸出結果到「庫存預估明細」和「負庫存警示」工作表
- **使用時機**：需要查看未來庫存預估和缺口分析時

#### 5. 清除日誌
- **功能**：清除執行日誌區域的內容
- **使用時機**：日誌太多，需要清理時

## 使用流程建議

### 日常使用流程

1. **首次使用或 Index 資料變更時**
   - 點擊「1. 同步 Index 資料」更新品名、生重、熟重

2. **每日開始時**
   - 點擊「2. 同步在製品庫存」更新在製品狀態

3. **生產排程變更時**
   - 點擊「3. 同步生產排程」重新計算生產片數

4. **需要查看庫存預估時**
   - 點擊「4. 計算庫存預估」查看未來庫存狀況

## 注意事項

1. **執行中狀態**
   - 執行任務時，所有按鈕會暫時停用
   - 請等待當前任務完成後再執行下一個任務
   - 可以在日誌區域查看執行進度

2. **錯誤處理**
   - 如果執行失敗，會顯示錯誤訊息
   - 詳細錯誤資訊會記錄在日誌區域
   - 請檢查日誌以了解失敗原因

3. **必要檔案**
   - 確保 `config.ini` 設定正確
   - 確保 `service_account.json` 憑證有效
   - 確保網路連線正常（需要連接 ERP 資料庫和 Google Sheets）

4. **資料庫連線**
   - 確保可以連接到 ERP 資料庫（192.168.98.10）
   - 確保已安裝 SQL Server ODBC 驅動程式

5. **Google Sheets 權限**
   - 確保服務帳戶有 Google Sheets 的讀寫權限

## 常見問題

### Q: 執行時出現「連接失敗」錯誤
**A:** 請檢查：
- 網路連線是否正常
- ERP 資料庫是否可訪問
- `config.ini` 中的連線設定是否正確

### Q: 無法更新 Google Sheets
**A:** 請檢查：
- `service_account.json` 檔案是否存在且有效
- 服務帳戶是否有 Google Sheets 的存取權限
- Google Sheets URL 是否正確

### Q: 計算結果不正確
**A:** 請檢查：
- Google Sheets 中的資料是否正確
- Index 工作表是否有完整的餅乾資料
- 生產排程和組裝排程資料是否正確

### Q: 程式執行很慢
**A:** 可能原因：
- 資料量較大，需要較長處理時間
- 網路連線較慢
- 資料庫查詢較慢

## 技術支援

如有問題，請查看：
- 執行日誌中的詳細錯誤訊息
- `打包說明.md` 中的疑難排解章節
- 系統設計文件
